---
title: "Making Copies"
linktitle: "Week 5: Making Copies"
output:
  blogdown::html_page:
    toc: true
menu:
  example:
    parent: Examples
    weight: 5
type: docs
weight: 1
editor_options: 
  chunk_output_type: console
---

<style>
.hvr-sweep-to-left {
  display: inline-block;
  vertical-align: middle;
  -webkit-transform: perspective(1px) translateZ(0);
  transform: perspective(1px) translateZ(0);
  box-shadow: 0 0 1px rgba(0, 0, 0, 0);
  position: relative;
  -webkit-transition-property: color;
  transition-property: color;
  -webkit-transition-duration: 0.25s;
  transition-duration: 0.25s;
}

.hvr-sweep-to-left:before {
  content: "";
  position: absolute;
  z-index: -1;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background:	#003277;
  -webkit-transform: scaleX(0);
  transform: scaleX(0);
  -webkit-transform-origin: 100% 50%;
  transform-origin: 100% 50%;
  -webkit-transition-property: transform;
  transition-property: transform;
  -webkit-transition-duration: 0.3s;
  transition-duration: 0.3s;
  -webkit-transition-timing-function: ease-out;
  transition-timing-function: ease-out;
}

.hvr-sweep-to-left:hover, .hvr-sweep-to-left:focus, .hvr-sweep-to-left:active {
  color: white;
}

.hvr-sweep-to-left:hover:before, .hvr-sweep-to-left:focus:before, .hvr-sweep-to-left:active:before {
  -webkit-transform: scaleX(1);
  transform: scaleX(1);
}

* {
  box-sizing: border-box;
}

.tabs {
  display: flex;
  flex-wrap: wrap;
  max-width: 700px;
  background: #efefef;
  box-shadow: 0 48px 80px -32px rgba(0,0,0,0.3);
}

.input {
  position: absolute;
  opacity: 0;
}

.label {
  width: 100%;
  padding: 20px 30px;
  background: #e5e5e5;
  cursor: pointer;
  font-weight: bold;
  font-size: 18px;
  color: #7f7f7f;
  transition: background 0.1s, color 0.1s;
}

.label:hover {
  background: #d8d8d8;
}

.label:active {
  background: #ccc;
}

.input:focus + .label {
  box-shadow: inset 0px 0px 0px 3px #2aa1c0;
  z-index: 1;
}

.input:checked + .label {
  background: #fff;
  color: #000;
}

@media (min-width: 600px) {
  .label {
    width: auto;
  }
}

.panel {
  display: none;
  padding: 20px 30px 30px;
  background: #fff;
}

@media (min-width: 600px) {
  .panel {
    order: 99;
  }
}

.input:checked + .label + .panel {
  display: block;
}
</style>

```{r echo=FALSE, message=FALSE, purl=FALSE}
library(knitr)
library(kableExtra)
library(tidyverse)
library(downloadthis)
library(here)
```

# Getting Prepped

## First Things First! Set your Working Directory

Your *working directory* is simply where your script will look for anything it needs like external data sets. There are a few ways to go about doing this which we will cover. However for now, just do the following:

1.  Open up a new script by going to `File > New File > R Script`.
2.  Save it in a preferably empty folder as whatever you want.
3.  Go to the menu bar and select `Session > Set Working Directory > To Source File Location`.

## Download the script

Copying and pasting syntax from a browser can cause problems. To avoid this issue, please download a script with all of the needed code presented in this walkthrough.

```{r echo=FALSE,eval=TRUE,purl=FALSE}
downloadthis::download_file(
  path = here::here("content", "example", "05-example.R"),
  output_name = "Week 5 Script Outline",
  button_label = "Download the Script",
  button_type = "default",
  has_icon = TRUE,
  icon = "fa fa-save",
  class = "hvr-sweep-to-left"
  )
```

## Read the Submission Directions
On a separate document (WORD or PDF), answer the questions in parts 1, 2, and 4. You may work alone of together in groups of up to three people and submit one task on [eCampus](https://ecampus.wvu.edu/){target="_blank"} by the end of class today.

## Load Up Some Libraries
Please go ahead and download the libraries below you don't have and load them up

```{r message=FALSE}
library(tidyverse)
```

# Part 1: More ggplotting

Scenario: Do cars with big engines use more fuel than cars with small engines?

OK so you probably know the answer but let's make the justification as precise as possible.

Let's use the `mpg` data frame found in `ggplot2`.
The data frame contains observations collected by the US Environment Protection Agency on 38 car models. To see all of the unique values, we can run

```{r}
unique(mpg$manufacturer)
```

which is equivalent to the following as a `tibble`

```{r}
mpg %>%
  select(manufacturer) %>%
  distinct()
```

## Finding variables

We can use `glimpse` to see more about each variable

```{r}
glimpse(mpg)
```

## Getting counts

We can use a quick(ish) plot of the manufacturers and how many of each is represented in the data set^[Take some time to change the values in the `ggplot` to see how it changes.]

```{r}
ggplot(mpg, aes(x = manufacturer, fill = manufacturer)) +
  geom_bar() +
  geom_text(stat = 'count', 
             aes(label = after_stat(count)), 
             vjust = -0.5) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, 
                                   vjust = 1.3,
                                   hjust = 1)) 
  
```

but sometimes its just easier to use `dplyr`

```{r}
mpg %>%
  select(manufacturer) %>%
  group_by(manufacturer) %>%
  tally() %>%
  ungroup()
```

which is basically saying

```{r, eval=FALSE}
Get the `mpg` tibble %>%
  Only show me the column `manufacturer` %>%
   Perform any wrangling by car manufacturer %>%
   Count by car manufacturer %>%
   Dont do any more wrangling by car manufacturer
```

The last step is somewhat important. R remembers certain things and grouping is one of them so its a good idea to `ungroup()` columns unless you know that is needed.

So what would happen if we didn't group? Well let's see

```{r}
mpg %>%
  select(manufacturer) %>%
  tally() 
```

It just gave us a full count of all cars. So grouping is a lifesaver if you want to perform any operations by the values in a column.

## Example: Using R to Test Hypotheses

Notice from the output 

```{r}
names(mpg)
```

that 

1. `displ`: a car’s engine size in liters. 
2. `hwy`: a car’s fuel efficiency on the highway, in miles per gallon (mpg). 

### Hypothesis
In all cases, a car with a low fuel efficiency consumes more fuel than a car with a high fuel efficiency when they travel the same distance.

### Exploring the Data
Let's take the variables `displ` and `hwy` and try to use them in plots

```{r}
ggplot(data = mpg) + 
  geom_point(aes(x = displ, y = hwy))
```

So what happened here? Well we simply put `displ` on the *x*-axis and hwy on the *y*-axis to compare them using points. The plot shows a negative relationship between engine size (displ) and fuel efficiency (hwy). In other words, cars with big engines use more fuel. Does this confirm or refute the hypothesis about fuel efficiency and engine size?

#### Part 1 Questions for You to Turn In

1. Run `ggplot(data = mpg)`. What do you see and why is it that way?
2. How many rows are in mpg? How many columns?
3. What does the drv variable describe?
4. Make a scatterplot of `hwy` vs `cyl.`
5. What happens if you make a scatterplot of `class` vs `drv`? Is the plot useful? Why or why not?

# Part 2: Aesthetics

Aesthetics are more than just coloring a plot, you can define directions, shapes, sizes, types, and provide a useful way to bring in a third variable into a static two dimensional image.

So how is this done? Well in a nutshell you can add a third variable to a two dimensional scatterplot by mapping it to an aesthetic. Recall that an **aesthetic** is a *visual property of the objects in your plot*.

You can convey information about your data by mapping the aesthetics in your plot to the variables in your dataset. For example, you can map the colors of your points to the class variable to reveal the class of each car.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class)) 
```
*or if you like British English, `colour` can be used interchangeably*

As a reminder, to map an aesthetic to a variable, associate the name of the aesthetic to the name of the variable inside `aes()`. `ggplot2` will automatically assign a unique level of the aesthetic - here a unique color - to each unique value of the variable, a process known as scaling. 

`ggplot2` will also add a legend that explains which levels correspond to which values but you can turn that off as well.

With that said, we mapped class to the color aesthetic, and though pretty^[I think] that may not be the best method since the graphic is a bit hard to decipher immediately. Instead, we could have mapped class to the size aesthetic in the same way.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class)) 
```

So what's up with the warning?  In this case, the exact size of each point would reveal its class affiliation. So the warning is telling us that mapping an unordered variable (*class*) to an ordered aesthetic (*size*) is not a good idea.

Basically you are trying to plot a categorical variable - the manufacturers of cars - against a continuous variable - a vehicle's fuel efficiency on the highway - and its telling you that you probably shouldn't do that^[but never say never!].

Ok well let's try something else to distinguish the types of vehicles. 

What about the *alpha* level better known as **transparency**, or *how much of the color can you see through*?

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))
```

No? Maybe the shape then

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

Uh oh. Something is missing from the plot! So what happened to the SUVs? `ggplot2` will only use *six shapes* at a time. By default, additional groups will go unplotted when you use the shape aesthetic so remember this and you'll save yourself from throwing a computer.

If you are a controlling person, you can also set the aesthetic properties of your geom manually. For example, we can make all of the points in our plot blue

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```

or even [WVU Blue](https://universityrelations.wvu.edu/brand-guide/color){target="_blank"}

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "#002855")
```

#### Part 2 Questions for You to Turn In

1. Run the following:

```{r eval=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, 
                           color = "blue"))
```

Why are the points not blue? What has gone wrong with this code and what is it actually doing?

2. Which variables in `mpg` are 
  - categorical? 
  - continuous?
  
3. Map a continuous variable to *color*, *size*, and *shape.* How do these aesthetics behave differently for categorical vs. continuous variables?

4. Briefly describe happens if you map the same variable to multiple aesthetics?

5. What does the stroke aesthetic do? What shapes does it work with? (Hint: you could use `?geom_point`)

6. What happens if you map an aesthetic to something other than a variable name, like `aes(colour = displ < 5)`?

# Part 3: Grouping

Maybe you'd like to use multiple colors. Let try something fun based off of this [palette](http://www.color-hex.com/color-palette/65496){target="_blank"}

```{r error=TRUE, eval=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), 
             color = c("#34738f", "#122f3d", "#be3e2b", "#ed8a45", "#f6de6c"))
```

Uh oh. That didn't work. Why not?

Well to `ggplot` there are 234 different data points and it doesn't know how you want that color palette distributed. By the power of mathematics, 5 < 234 so you get an error. To fix it, you either assign 1 color to every data point or 234 different colors. Neither of these sound great. So what can we do? 

Well we can group by category. That may help. If you run 

```{r}
mpg$class
```

that doesn't help you much in figuring out the types of vehicles we have (yes we did find it before by plotting but assume we hadn't). Unless you like to clean this type of mess, we simply want to find the unique values and moreover, for coloring purposes, how many we have. 

Again to find a list of unique values, we can run 

```{r}
unique(mpg$class)
```

Well that's better but I'm lazy and don't want to count so let's find the number of unique values

```{r}
length(unique(mpg$class))
```

Oh good! There are 7 so that implies when we plot by class (type of vehicle), we need to have seven colors.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```

which we did earlier. But to fill it with what we want, we need to override the default colors

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, 
                           color = class)) +
  scale_color_manual(values = c("#490A3D", "#BD1550", "#E97F02", "#F8CA00", "#8A9B0F", "#95C7D8", "#FFBFF5"))
```

Note that since the class variable (type of vehicle) is discrete, we can use `scale_color_manual()`. Other discrete scales in ggplot can be found [here](https://ggplot2.tidyverse.org/reference/scale_manual.html){target="_blank"}

Continuous variables use other scales and you can fins more about that and other scales can be found [here](https://ggplot2.tidyverse.org/reference/#section-scales){target="_blank"}

Now those dots are pretty small. Let's make them bigger.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class), size = 2) +
  scale_color_manual(values = c("#490A3D", "#BD1550", "#E97F02", "#F8CA00", "#8A9B0F", "#95C7D8", "#FFBFF5"))
```

That does look better but why is the size now within the geom_point aesthetic? If you don't know, that's ok! We'll
get to that later but  for now, think about it.

##### NOTE 
You're writing code so you will get errors! But one common problem when creating ggplot2 graphics is to put the `+` in the wrong place: 

It has to come at the end of the line, not the start. In other words, make  sure you haven’t accidentally written code like this

```{r eval=FALSE}
ggplot(data = mpg) 
+ geom_point(mapping = aes(x = displ, y = hwy))
```

If you’re still stuck, try the help. You can get help about any R function by running `?function_name` in the console, or selecting the function name and pressing F1 in RStudio. Don’t worry if the help doesn’t seem that helpful - instead skip down to the examples and look for examples that may match what you’re trying to do. For the aesthetics, run

`?aes`

# Part 4: Facets

Another way to add additional variables is with aesthetics. Another way, particularly useful for categorical variables, is to split your plot into facets, subplots that each display one subset of the data set.

To facet your plot by a single variable, you can use `facet_wrap()` or `facet_grid()`. Let's fow now just concentrate on wrapping the data set.

The first argument of `facet_wrap()` should be a formula, which you create with `~` followed by a variable name - here “formula” is the name of a data structure in R, not a synonym for an “equation”. 

The variable that you pass to `facet_wrap()` should be discrete so it can essentially be split apart.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class), size = 2) +
  scale_color_manual(values = c("#490A3D", "#BD1550", "#E97F02", "#F8CA00", "#8A9B0F", "#95C7D8", "#FFBFF5")) +
 facet_wrap(~ class, nrow = 2)
```

To facet your plot on the combination of two variables, use `facet_grid()` to your plot The first argument 
of this is also a formula. This time the formula should contain two variable names separated by a `~`.

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class), size = 2) +
  scale_color_manual(values = c("#490A3D", "#BD1550", "#E97F02", "#F8CA00", "#8A9B0F", "#95C7D8", "#FFBFF5")) +
  facet_grid(drv ~ cyl)
```

If you prefer to not facet particular rows or columns, you can just use a `.` instead of a variable name to imply the entire data set

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class), size = 2) +
  scale_color_manual(values = c("#490A3D", "#BD1550", "#E97F02", "#F8CA00", "#8A9B0F", "#95C7D8", "#FFBFF5")) +
  facet_grid(. ~ cyl)
```

#### Part 4 Questions for You to Turn In

1. What happens if you facet on a continuous variable?

2. What do the empty cells in plot with `facet_grid(drv ~ cyl)` mean? How do they relate to this plot?

```{r eval=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = drv, y = cyl))
```

3. What plots does the following code make? What does . do?

- Plot 1
```{r eval=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)
```

- Plot 2
```{r eval=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
```

4. Take the faceted plot below and compare it to the one with color you did earlier

```{r eval=FALSE}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```

What are the advantages to using faceting instead of the color aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?

5. Read `?facet_wrap`. What does `nrow` do? What does `ncol` do? What other options control the layout of  the individual panels? Why doesn’t `facet_grid()` have `nrow` and `ncol` arguments (aka options)?

6. When using `facet_grid()` you should usually put the variable with more unique levels in the columns. Why?
